!function t(e,i,s){function a(o,h){if(!i[o]){if(!e[o]){var r="function"==typeof require&&require;if(!h&&r)return r(o,!0);if(n)return n(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return a(i?i:t)},l,l.exports,t,e,i,s)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)a(s[o]);return a}({1:[function(t,e,i){"use strict";!function(){var e=t("./init.js"),i=t("./utils.js"),s=t("./states/boot.js"),a=t("./states/preloader.js"),n=t("./states/menu.js"),o=t("./states/game.js"),h=t("./states/win.js"),r=window.Phaser?window.Phaser:void 0;if(void 0===r)throw new Error("Phaser didn't load correctly. Please reload the website.");var l=new r.Game(e.gameWidth(),e.gameHeight(),r.CANVAS,"gameDiv",null,!1,!1);l.utils=i,l.init=e,l.state.add("Boot",s),l.state.add("Preloader",a),l.state.add("Menu",n),l.state.add("Game",o),l.state.add("Win",h),l.state.start("Boot")}()},{"./init.js":2,"./states/boot.js":3,"./states/game.js":4,"./states/menu.js":5,"./states/preloader.js":6,"./states/win.js":7,"./utils.js":8}],2:[function(t,e,i){"use strict";e.exports={pixelScale:10,gameSpeed:.5,gameInit:!1,gameOver:!1,enemySpeed:300,ajax:!0,score:0,levelIndex:0,nextLevel:[10,100,1e3],win:1e4,gameId:"CarCrash",highscore:0,level:0,gameSpeedSlower:function(){return this.gameSpeed/2},gameSpeedSlowest:function(){return this.gameSpeed/10},lanes:function(){var t=36*this.pixelScale,e=42*this.pixelScale,i=40.5*this.pixelScale;return[t,e,i]},gravity:function(){return-35*this.pixelScale},carPedal:function(){return 10*this.pixelScale},gameWidth:function(){return 30*this.pixelScale},gameHeight:function(){return 60*this.pixelScale}}},{}],3:[function(t,e,i){"use strict";var s=function(){};s.prototype={preload:function(){this.game.load.image("preloader","assets/preloader.png"),this.game.load.image("fblogo","assets/fblogow.png")},create:function(){this.game.input.maxPointers=1,this.game.device.desktop?(this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.refresh()):(this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.minWidth=480,this.game.scale.minHeight=260,this.game.scale.maxWidth=640,this.game.scale.maxHeight=480,this.game.scale.forceLandscape=!0,this.game.scale.pageAlignHorizontally=!0),this.game.state.start("Preloader")}},e.exports=s},{}],4:[function(t,e,i){"use strict";var s,a=function(){};e.exports=a,a.prototype={create:function(){this.physics.startSystem(Phaser.Physics.ARCADE),s=this.game.input.keyboard.createCursorKeys(),this.enterKey=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.game.stage.backgroundColor=16732224,this.bground=this.add.sprite(0,0,"bground"),this.scaleSprite(this.bground),this.level=this.add.tileSprite(0,0,30,60*this.game.init.pixelScale,"lv1"),this.scaleSprite(this.level),this.floor=this.add.tileSprite(0,45*this.game.init.pixelScale,30,15,"floor1"),this.scaleSprite(this.floor),this.road=this.add.tileSprite(0,34*this.game.init.pixelScale,30,13,"road"),this.scaleSprite(this.road),this.trucks=this.add.group(),this.trucks.enableBody=!0,this.physics.arcade.enable(this.trucks);for(var t=0;2>t;t++)this.truck=this.trucks.create(-9*this.game.init.pixelScale,this.game.init.lanes()[t],"truck"),this.scaleSprite(this.truck);this.car=this.add.sprite(5*this.game.init.pixelScale,36*this.game.init.pixelScale,"car"),this.car.animations.add("explode",[1,2,3,4,5,6],10,!1).killOnComplete=!0,this.scaleSprite(this.car),this.physics.arcade.enable(this.car),this.enemies=this.add.group(),this.enemies.enableBody=!0,this.physics.arcade.enable(this.enemies);for(var t=0;2>t;t++)this.enemy=this.enemies.create(30*this.game.init.pixelScale*(1+t),this.game.init.lanes()[t],"enemy"),this.enemy.animations.add("explodeRed",[1,2,3,4,5,6],10,!1).killOnComplete=!0,this.scaleSprite(this.enemy);this.bitmapTextFont=this.add.bitmapText(0,5*this.game.init.pixelScale,"litto",0,this.game.init.pixelScale),this.over=this.add.sprite(5*this.game.init.pixelScale,15*this.game.init.pixelScale,"over"),this.scaleSprite(this.over),this.over.alpha=0,this.retry=this.add.button(9*this.game.init.pixelScale,35*this.game.init.pixelScale,"retry"),this.scaleSprite(this.retry),this.retry.alpha=0,this.themesong=this.game.add.audio("themesong"),this.sound.setDecodedCallback(this.themesong,this.startSong,this)},update:function(){if(this.game.utils.tileAnimation(this.level,this.game.init.gameSpeedSlowest()),this.game.utils.tileAnimation(this.floor,this.game.init.gameSpeed),this.game.utils.tileAnimation(this.road,this.game.init.gameSpeedSlower()),this.game.init.gameInit===!1&&(s.down.isDown||s.up.isDown||this.game.input.activePointer.isDown)&&this.gameStart(),this.game.init.nextLevel[this.game.init.levelIndex]===this.game.init.score&&(this.bground.frame=this.game.init.levelIndex+1,this.game.utils.fadeOut(this.level,0,this),this.game.utils.fadeOut(this.floor,0,this),this.game.init.levelIndex++,this.game.time.events.add(1*Phaser.Timer.SECOND,this.fadeInNewLevel,this)),this.game.init.score===this.game.init.win){var t={game:this.game.init.gameId,wins:1};this.ajaxPut(t,"/api/stats"),this.themesong.stop(),this.game.state.start("Win")}this.game.init.gameOver===!0&&this.game.init.ajax===!0&&(this.themesong.stop(),this.gameOver()),!(s.up.isDown||this.game.input.activePointer.isDown&&this.game.input.activePointer.position.y<this.game.init.lanes()[2])||this.car.y!==this.game.init.lanes()[0]&&this.car.y!==this.game.init.lanes()[1]?!(s.down.isDown||this.game.input.activePointer.isDown&&this.game.input.activePointer.position.y>this.game.init.lanes()[2])||this.car.y!==this.game.init.lanes()[0]&&this.car.y!==this.game.init.lanes()[1]||this.carMoveDown():this.carMoveUp();var e=this;this.enemies.forEach(function(t){t.x<=-5*e.game.init.pixelScale&&e.game.init.gameOver===!1&&(t.y=e.game.init.lanes()[0]+(e.game.init.lanes()[1]-e.game.init.lanes()[0])*e.game.rnd.integerInRange(0,1),t.x=60*e.game.init.pixelScale,e.game.init.score++)}),this.bitmapTextFont.text=this.game.init.score,this.bitmapTextFont.x=(30*this.game.init.pixelScale-this.bitmapTextFont.width)/2,this.game.physics.arcade.overlap(this.car,this.trucks,this.truckExplode,null,this),this.game.physics.arcade.overlap(this.car,this.enemies,this.carExplode,null,this),this.game.physics.arcade.overlap(this.truck,this.enemies,this.enemyExplode,null,this)},render:function(){},carMoveUp:function(){this.carAccelerates(this.car),this.game.add.tween(this.car).to({y:this.game.init.lanes()[0]},300,Phaser.Easing.Sinusoidal.InOut,!0,0)},carMoveDown:function(){this.carAccelerates(this.car),this.game.add.tween(this.car).to({y:this.game.init.lanes()[1]},300,Phaser.Easing.Sinusoidal.InOut,!0,0)},carExplode:function(t,e){t.animations.play("explode"),e.animations.play("explodeRed"),this.game.init.gameOver=!0},truckExplode:function(t,e){this.carAccelerates(this.car),t.animations.play("explode"),e.body.velocity.x=this.game.init.enemySpeed,this.game.init.gameOver=!0},enemyExplode:function(t,e){t.body.velocity.x===this.game.init.enemySpeed&&(e.animations.play("explodeRed"),this.carAccelerates(e))},scaleSprite:function(t){t.scale.x=this.game.init.pixelScale,t.scale.y=this.game.init.pixelScale},gameStart:function(){this.car.body.gravity.x=this.game.init.gravity(),this.enemies.setAll("body.velocity.x",-this.game.init.enemySpeed),this.game.init.gameInit=!0},gameOver:function(){this.game.init.score>this.game.init.highscore&&(this.game.init.highscore=this.game.init.score);var t={game:this.game.init.gameId,highscore:this.game.init.highscore,level:this.game.init.level};this.ajaxPut(t,"/api/stats"),this.ajaxGet("/api/highscores"),this.game.utils.fadeOut(this.bground,0,this),this.game.utils.fadeOut(this.level,0,this),this.game.utils.fadeOut(this.floor,0,this),this.game.utils.fadeIn(this.over,0,this),this.game.utils.fadeIn(this.retry,0,this),this.game.time.events.add(.5*Phaser.Timer.SECOND,this.retryEnableInput,this)},retryEnableInput:function(){this.retry.events.onInputDown.addOnce(this.gameReload,this),this.enterKey.onDown.add(this.gameReload,this)},gameReload:function(){var t={game:this.game.init.gameId,plays:1};this.ajaxPut(t,"/api/stats"),this.game.init.gameInit=!1,this.game.init.gameOver=!1,this.game.init.score=0,this.game.init.levelIndex=0,this.game.init.ajax=!0,this.state.restart(!0,!1)},carAccelerates:function(t){t.body.velocity.x=this.game.init.carPedal()},ajaxPut:function(t,e){var i=new XMLHttpRequest;i.open("PUT",e,!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.send(JSON.stringify(t)),this.game.init.ajax=!1},ajaxGet:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0);var i=this;e.onload=function(){if(e.status>=200&&e.status<400)for(var t=JSON.parse(e.responseText),s=0;s<t.length;s++)i.checkHighscore(t[s].highscore.score);else console.log("We reached our target server, but it returned an error.")},e.onerror=function(){console.log("There was a connection error of some sort.")},e.send()},fadeInNewLevel:function(){if(this.game.init.gameOver===!1){var t="lv"+(this.game.init.levelIndex+1),e="floor"+(this.game.init.levelIndex+1);this.level.loadTexture(t),this.floor.loadTexture(e),this.game.utils.fadeIn(this.level,0,this),this.game.utils.fadeIn(this.floor,0,this)}},checkHighscore:function(t){this.game.init.score>t&&console.log("new record!")}},a.prototype.startSong=function(){this.themesong.loopFull(.5)}},{}],5:[function(t,e,i){"use strict";var s=function(){};s.prototype={create:function(){this.stage.backgroundColor=3289907,this.menu=this.add.tileSprite(0,0,30,60,"menu"),this.scaleSprite(this.menu),this.menu.inputEnabled=!0,this.themesong=this.game.add.audio("themesong"),this.sound.setDecodedCallback(this.themesong,this.startSong,this),this.title=this.add.tileSprite(0,15*this.game.init.pixelScale,30,5,"title"),this.scaleSprite(this.title),this.title.alpha=0,this.fblogo=this.add.tileSprite(this.game.init.gameWidth()-70,this.game.init.gameHeight()-32,30,11,"fblogo"),this.fblogo.scale.x=2,this.fblogo.scale.y=2,this.enterKey=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.menu.events.onInputDown.addOnce(this.startGame,this),this.enterKey.onDown.add(this.startGame,this)},update:function(){this.game.utils.fadeIn(this.title,120,this)}},s.prototype.scaleSprite=function(t){t.scale.x=this.game.init.pixelScale,t.scale.y=this.game.init.pixelScale},s.prototype.startGame=function(){this.themesong.stop(),this.state.start("Game")},s.prototype.startSong=function(){this.themesong.loopFull(.5)},e.exports=s},{}],6:[function(t,e,i){"use strict";var s=function(t){this.ready=!1};s.prototype={preload:function(){this.setProgressLogo(),this.load.image("menu","assets/menu.png"),this.load.image("title","assets/title.png"),this.load.spritesheet("bground","assets/backgrounds.png",30,60,4),this.load.image("lv1","assets/lv1.png"),this.load.image("lv2","assets/lv2.png"),this.load.image("lv3","assets/lv3.png"),this.load.image("lv4","assets/lv4.png"),this.load.image("road","assets/road.png"),this.load.image("floor1","assets/floor1.png"),this.load.image("floor2","assets/floor2.png"),this.load.image("floor3","assets/floor3.png"),this.load.image("floor4","assets/floor4.png"),this.load.spritesheet("car","assets/car.png",5,3,8),this.load.spritesheet("enemy","assets/enemy.png",5,3,8),this.load.image("truck","assets/truck.png"),this.load.bitmapFont("litto","assets/litto.png","assets/litto.xml"),this.load.image("over","assets/over.png"),this.load.image("retry","assets/retry.png"),this.load.audio("themesong","assets/themesong.m4a"),this.load.image("winback","assets/winback.png"),this.load.image("wintitle","assets/wintitle.png"),this.load.onLoadComplete.addOnce(this.onLoadComplete,this)},update:function(){this.ready&&this.game.state.start("Menu")}},s.prototype.setProgressLogo=function(){this.progress=this.add.sprite(this.game.init.gameWidth()/2-110,this.game.init.gameHeight()/2,"preloader"),this.fblogo=this.add.tileSprite(this.game.init.gameWidth()/2-90,this.game.init.gameHeight()/2-90,30,11,"fblogo"),this.fblogo.scale.x=6,this.fblogo.scale.y=6,this.progress.cropEnabled=!1,this.load.setPreloadSprite(this.progress)},s.prototype.onLoadComplete=function(){this.ready=!0},e.exports=s},{}],7:[function(t,e,i){"use strict";var s=function(){};s.prototype={create:function(){this.stage.backgroundColor=3289907,this.menu=this.add.tileSprite(0,0,30,60,"winback"),this.scaleSprite(this.menu),this.menu.inputEnabled=!0,this.title=this.add.tileSprite(0,15*this.game.init.pixelScale,30,5,"wintitle"),this.scaleSprite(this.title),this.title.alpha=0,this.fblogo=this.add.tileSprite(this.game.init.gameWidth()-70,this.game.init.gameHeight()-32,30,11,"fblogo"),this.fblogo.scale.x=2,this.fblogo.scale.y=2},update:function(){this.game.utils.fadeIn(this.title,120,this)}},s.prototype.scaleSprite=function(t){t.scale.x=this.game.init.pixelScale,t.scale.y=this.game.init.pixelScale},e.exports=s},{}],8:[function(t,e,i){"use strict";var s={fadeOut:function(t,e,i){i.game.add.tween(t).to({alpha:0},e,Phaser.Easing.Sinusoidal.InOut,!0,0)},fadeIn:function(t,e,i){i.game.add.tween(t).to({alpha:1},e,Phaser.Easing.Sinusoidal.InOut,!0,0)},tileAnimation:function(t,e){t.tilePosition.x-=e}};e.exports=s},{}]},{},[1]);