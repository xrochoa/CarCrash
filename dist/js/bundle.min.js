!function e(t,i,s){function a(o,r){if(!i[o]){if(!t[o]){var h="function"==typeof require&&require;if(!r&&h)return h(o,!0);if(n)return n(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=i[o]={exports:{}};t[o][0].call(l.exports,function(e){var i=t[o][1][e];return a(i?i:e)},l,l.exports,e,t,i,s)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)a(s[o]);return a}({1:[function(e,t,i){"use strict";!function(){var t=e("./init.js"),i=e("./utils.js"),s=e("./states/boot.js"),a=e("./states/preloader.js"),n=e("./states/menu.js"),o=e("./states/game.js"),r=e("./states/win.js"),h=window.Phaser?window.Phaser:void 0;if(void 0===h)throw new Error("Phaser didn't load correctly. Please reload the website.");var l=new h.Game(t.gameWidth(),t.gameHeight(),h.CANVAS,"gameDiv",null,!1,!1);l.utils=i,l.init=t,l.state.add("Boot",s),l.state.add("Preloader",a),l.state.add("Menu",n),l.state.add("Game",o),l.state.add("Win",r),l.state.start("Boot")}()},{"./init.js":2,"./states/boot.js":3,"./states/game.js":4,"./states/menu.js":5,"./states/preloader.js":6,"./states/win.js":7,"./utils.js":8}],2:[function(e,t,i){"use strict";t.exports={pixelScale:10,gameSpeed:.5,gameInit:!1,gameOver:!1,enemySpeed:300,ajax:!0,score:0,levelIndex:0,nextLevel:[10,100,1e3],win:1e4,gameId:"CarCrash",highscore:0,level:0,gameSpeedSlower:function(){return this.gameSpeed/2},gameSpeedSlowest:function(){return this.gameSpeed/10},lanes:function(){var e=36*this.pixelScale,t=42*this.pixelScale,i=40.5*this.pixelScale;return[e,t,i]},gravity:function(){return-35*this.pixelScale},carPedal:function(){return 10*this.pixelScale},gameWidth:function(){return 30*this.pixelScale},gameHeight:function(){return 60*this.pixelScale}}},{}],3:[function(e,t,i){"use strict";var s=function(){};s.prototype={preload:function(){var e=this.load;e.image("preloader","assets/preloader.png"),e.image("fblogo","assets/fblogow.png")},create:function(){var e=this.game,t=this.scale,i=this;i.input.maxPointers=1,e.device.desktop?(t.pageAlignHorizontally=!0,t.pageAlignVertically=!0,t.refresh()):(t.scaleMode=Phaser.ScaleManager.SHOW_ALL,t.minWidth=480,t.minHeight=260,t.maxWidth=640,t.maxHeight=480,t.forceLandscape=!0,t.pageAlignHorizontally=!0),i.state.start("Preloader")}},t.exports=s},{}],4:[function(e,t,i){"use strict";var s,a=function(){};t.exports=a,a.prototype={create:function(){this.physics.startSystem(Phaser.Physics.ARCADE),s=this.game.input.keyboard.createCursorKeys(),this.enterKey=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.game.stage.backgroundColor=16732224,this.bground=this.add.sprite(0,0,"bground"),this.scaleSprite(this.bground),this.level=this.add.tileSprite(0,0,30,60*this.game.init.pixelScale,"lv1"),this.scaleSprite(this.level),this.floor=this.add.tileSprite(0,45*this.game.init.pixelScale,30,15,"floor1"),this.scaleSprite(this.floor),this.road=this.add.tileSprite(0,34*this.game.init.pixelScale,30,13,"road"),this.scaleSprite(this.road),this.trucks=this.add.group(),this.trucks.enableBody=!0,this.physics.arcade.enable(this.trucks);for(var e=0;2>e;e++)this.truck=this.trucks.create(-9*this.game.init.pixelScale,this.game.init.lanes()[e],"truck"),this.scaleSprite(this.truck);this.car=this.add.sprite(5*this.game.init.pixelScale,36*this.game.init.pixelScale,"car"),this.car.animations.add("explode",[1,2,3,4,5,6],10,!1).killOnComplete=!0,this.scaleSprite(this.car),this.physics.arcade.enable(this.car),this.enemies=this.add.group(),this.enemies.enableBody=!0,this.physics.arcade.enable(this.enemies);for(var e=0;2>e;e++)this.enemy=this.enemies.create(30*this.game.init.pixelScale*(1+e),this.game.init.lanes()[e],"enemy"),this.enemy.animations.add("explodeRed",[1,2,3,4,5,6],10,!1).killOnComplete=!0,this.scaleSprite(this.enemy);this.bitmapTextFont=this.add.bitmapText(0,5*this.game.init.pixelScale,"litto",0,this.game.init.pixelScale),this.over=this.add.sprite(5*this.game.init.pixelScale,15*this.game.init.pixelScale,"over"),this.scaleSprite(this.over),this.over.alpha=0,this.retry=this.add.button(9*this.game.init.pixelScale,35*this.game.init.pixelScale,"retry"),this.scaleSprite(this.retry),this.retry.alpha=0,this.themesong=this.game.add.audio("themesong"),this.sound.setDecodedCallback(this.themesong,this.startSong,this)},update:function(){if(this.game.utils.tileAnimation(this.level,this.game.init.gameSpeedSlowest()),this.game.utils.tileAnimation(this.floor,this.game.init.gameSpeed),this.game.utils.tileAnimation(this.road,this.game.init.gameSpeedSlower()),this.game.init.gameInit===!1&&(s.down.isDown||s.up.isDown||this.game.input.activePointer.isDown)&&this.gameStart(),this.game.init.nextLevel[this.game.init.levelIndex]===this.game.init.score&&(this.bground.frame=this.game.init.levelIndex+1,this.game.utils.fadeOut(this.level,0,this),this.game.utils.fadeOut(this.floor,0,this),this.game.init.levelIndex++,this.game.time.events.add(1*Phaser.Timer.SECOND,this.fadeInNewLevel,this)),this.game.init.score===this.game.init.win){var e={game:this.game.init.gameId,wins:1};this.ajaxPut(e,"/api/stats"),this.themesong.stop(),this.game.state.start("Win")}this.game.init.gameOver===!0&&this.game.init.ajax===!0&&(this.themesong.stop(),this.gameOver()),!(s.up.isDown||this.game.input.activePointer.isDown&&this.game.input.activePointer.position.y<this.game.init.lanes()[2])||this.car.y!==this.game.init.lanes()[0]&&this.car.y!==this.game.init.lanes()[1]?!(s.down.isDown||this.game.input.activePointer.isDown&&this.game.input.activePointer.position.y>this.game.init.lanes()[2])||this.car.y!==this.game.init.lanes()[0]&&this.car.y!==this.game.init.lanes()[1]||this.carMoveDown():this.carMoveUp();var t=this;this.enemies.forEach(function(e){e.x<=-5*t.game.init.pixelScale&&t.game.init.gameOver===!1&&(e.y=t.game.init.lanes()[0]+(t.game.init.lanes()[1]-t.game.init.lanes()[0])*t.game.rnd.integerInRange(0,1),e.x=60*t.game.init.pixelScale,t.game.init.score++)}),this.bitmapTextFont.text=this.game.init.score,this.bitmapTextFont.x=(30*this.game.init.pixelScale-this.bitmapTextFont.width)/2,this.game.physics.arcade.overlap(this.car,this.trucks,this.truckExplode,null,this),this.game.physics.arcade.overlap(this.car,this.enemies,this.carExplode,null,this),this.game.physics.arcade.overlap(this.truck,this.enemies,this.enemyExplode,null,this)},render:function(){},carMoveUp:function(){this.carAccelerates(this.car),this.game.add.tween(this.car).to({y:this.game.init.lanes()[0]},300,Phaser.Easing.Sinusoidal.InOut,!0,0)},carMoveDown:function(){this.carAccelerates(this.car),this.game.add.tween(this.car).to({y:this.game.init.lanes()[1]},300,Phaser.Easing.Sinusoidal.InOut,!0,0)},carExplode:function(e,t){e.animations.play("explode"),t.animations.play("explodeRed"),this.game.init.gameOver=!0},truckExplode:function(e,t){this.carAccelerates(this.car),e.animations.play("explode"),t.body.velocity.x=this.game.init.enemySpeed,this.game.init.gameOver=!0},enemyExplode:function(e,t){e.body.velocity.x===this.game.init.enemySpeed&&(t.animations.play("explodeRed"),this.carAccelerates(t))},scaleSprite:function(e){e.scale.x=this.game.init.pixelScale,e.scale.y=this.game.init.pixelScale},gameStart:function(){this.car.body.gravity.x=this.game.init.gravity(),this.enemies.setAll("body.velocity.x",-this.game.init.enemySpeed),this.game.init.gameInit=!0},gameOver:function(){this.game.init.score>this.game.init.highscore&&(this.game.init.highscore=this.game.init.score);var e={game:this.game.init.gameId,highscore:this.game.init.highscore,level:this.game.init.level};this.ajaxPut(e,"/api/stats"),this.ajaxGet("/api/highscores"),this.game.utils.fadeOut(this.bground,0,this),this.game.utils.fadeOut(this.level,0,this),this.game.utils.fadeOut(this.floor,0,this),this.game.utils.fadeIn(this.over,0,this),this.game.utils.fadeIn(this.retry,0,this),this.game.time.events.add(.5*Phaser.Timer.SECOND,this.retryEnableInput,this)},retryEnableInput:function(){this.retry.events.onInputDown.addOnce(this.gameReload,this),this.enterKey.onDown.add(this.gameReload,this)},gameReload:function(){var e={game:this.game.init.gameId,plays:1};this.ajaxPut(e,"/api/stats"),this.game.init.gameInit=!1,this.game.init.gameOver=!1,this.game.init.score=0,this.game.init.levelIndex=0,this.game.init.ajax=!0,this.state.restart(!0,!1)},carAccelerates:function(e){e.body.velocity.x=this.game.init.carPedal()},ajaxPut:function(e,t){var i=new XMLHttpRequest;i.open("PUT",t,!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.send(JSON.stringify(e)),this.game.init.ajax=!1},ajaxGet:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0);var i=this;t.onload=function(){if(t.status>=200&&t.status<400)for(var e=JSON.parse(t.responseText),s=0;s<e.length;s++)i.checkHighscore(e[s].highscore.score);else console.log("We reached our target server, but it returned an error.")},t.onerror=function(){console.log("There was a connection error of some sort.")},t.send()},fadeInNewLevel:function(){if(this.game.init.gameOver===!1){var e="lv"+(this.game.init.levelIndex+1),t="floor"+(this.game.init.levelIndex+1);this.level.loadTexture(e),this.floor.loadTexture(t),this.game.utils.fadeIn(this.level,0,this),this.game.utils.fadeIn(this.floor,0,this)}},checkHighscore:function(e){this.game.init.score>e&&console.log("new record!")}},a.prototype.startSong=function(){this.themesong.loopFull(.5)}},{}],5:[function(e,t,i){"use strict";var s,a,n,o,r,h,l=function(){};l.prototype={create:function(){s=this;var e=s.add,t=s.game;s.stage.backgroundColor=3289907,a=e.tileSprite(0,0,30,60,"menuBg"),s.scaleSprite(a),a.inputEnabled=!0,r=e.audio("themeSong"),s.sound.setDecodedCallback(r,s.startSong,s),n=e.tileSprite(0,15*t.init.pixelScale,30,5,"title"),s.scaleSprite(n),n.alpha=0,o=e.tileSprite(t.init.gameWidth()-70,t.init.gameHeight()-32,30,11,"fblogo"),o.scale.x=2,o.scale.y=2,h=t.input.keyboard.addKey(Phaser.Keyboard.ENTER),a.events.onInputDown.addOnce(s.startGame,s),h.onDown.add(s.startGame,s)},update:function(){s.game.utils.fadeIn(n,120,this)}},l.prototype.scaleSprite=function(e){e.scale.x=this.game.init.pixelScale,e.scale.y=this.game.init.pixelScale},l.prototype.startGame=function(){r.stop(),s.state.start("Game")},l.prototype.startSong=function(){r.loopFull(.5)},t.exports=l},{}],6:[function(e,t,i){"use strict";var s=function(){};s.prototype={preload:function(){var e=this,t=e.load;e.setProgressLogo(),t.image("menuBg","assets/menu.png"),t.image("title","assets/title.png"),t.spritesheet("bground","assets/backgrounds.png",30,60,4),t.image("lv1","assets/lv1.png"),t.image("lv2","assets/lv2.png"),t.image("lv3","assets/lv3.png"),t.image("lv4","assets/lv4.png"),t.image("road","assets/road.png"),t.image("floor1","assets/floor1.png"),t.image("floor2","assets/floor2.png"),t.image("floor3","assets/floor3.png"),t.image("floor4","assets/floor4.png"),t.spritesheet("car","assets/car.png",5,3,8),t.spritesheet("enemy","assets/enemy.png",5,3,8),t.image("truck","assets/truck.png"),t.bitmapFont("litto","assets/litto.png","assets/litto.xml"),t.image("over","assets/over.png"),t.image("retry","assets/retry.png"),t.audio("themeSong","assets/themesong.m4a"),t.image("winback","assets/winback.png"),t.image("wintitle","assets/wintitle.png"),t.onLoadComplete.add(e.onLoadComplete,e)}},s.prototype.setProgressLogo=function(){var e=this.game,t=this.load,i=this.add,s=i.sprite(e.init.gameWidth()/2-110,e.init.gameHeight()/2,"preloader");s.cropEnabled=!1;var a=i.tileSprite(e.init.gameWidth()/2-90,e.init.gameHeight()/2-90,30,11,"fblogo");a.scale.x=6,a.scale.y=6,t.setPreloadSprite(s)},s.prototype.onLoadComplete=function(){var e=this;e.state.start("Menu")},t.exports=s},{}],7:[function(e,t,i){"use strict";var s=function(){};s.prototype={create:function(){this.stage.backgroundColor=3289907,this.menu=this.add.tileSprite(0,0,30,60,"winback"),this.scaleSprite(this.menu),this.menu.inputEnabled=!0,this.title=this.add.tileSprite(0,15*this.game.init.pixelScale,30,5,"wintitle"),this.scaleSprite(this.title),this.title.alpha=0,this.fblogo=this.add.tileSprite(this.game.init.gameWidth()-70,this.game.init.gameHeight()-32,30,11,"fblogo"),this.fblogo.scale.x=2,this.fblogo.scale.y=2},update:function(){this.game.utils.fadeIn(this.title,120,this)}},s.prototype.scaleSprite=function(e){e.scale.x=this.game.init.pixelScale,e.scale.y=this.game.init.pixelScale},t.exports=s},{}],8:[function(e,t,i){"use strict";var s={fadeOut:function(e,t,i){i.game.add.tween(e).to({alpha:0},t,Phaser.Easing.Sinusoidal.InOut,!0,0)},fadeIn:function(e,t,i){i.game.add.tween(e).to({alpha:1},t,Phaser.Easing.Sinusoidal.InOut,!0,0)},tileAnimation:function(e,t){e.tilePosition.x-=t}};t.exports=s},{}]},{},[1]);